<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calentamiento Global</title>
    <link rel="stylesheet" href="style.css"> <!-- AquÃ­ enlazas el CSS -->
    <style>
        /* Estilos rÃ¡pidos solo para la secciÃ³n de puntos */
        .game-box {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
        }
        label, select, input, button {
            font-size: 16px;
            margin: 8px 0;
            display: block;
        }
        button {
            padding: 10px 15px;
            background: #6eff6e;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        button:hover {
            background: #4dc34d;
        }
        .score {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
            color: #ff914d;
        }
        .ranking {
            margin-top: 20px;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }
        .ranking h3 {
            margin-bottom: 10px;
            color: #6eff6e;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸŒ Calentamiento Global</h1>
        <p>
            El calentamiento global es uno de los mayores desafÃ­os de nuestra Ã©poca. 
            Representa el aumento de la temperatura promedio del planeta debido a la actividad humana,
            principalmente por la emisiÃ³n de gases de efecto invernadero.
        </p>

        <div class="section">
            <h2>ğŸ”¥ Causas</h2>
            <p>- Quema de combustibles fÃ³siles (carbÃ³n, petrÃ³leo, gas).</p>
            <p>- DeforestaciÃ³n y pÃ©rdida de bosques.</p>
            <p>- Uso excesivo de energÃ­a no renovable.</p>
            <p>- ProducciÃ³n industrial y transporte contaminante.</p>
        </div>

        <div class="section">
            <h2>ğŸŒŠ Consecuencias</h2>
            <p>- Aumento del nivel del mar por deshielo de glaciares.</p>
            <p>- FenÃ³menos climÃ¡ticos extremos (huracanes, sequÃ­as, olas de calor).</p>
            <p>- PÃ©rdida de biodiversidad y especies en peligro.</p>
            <p>- Impacto en la salud humana y en la seguridad alimentaria.</p>
        </div>

        <div class="section">
            <h2>ğŸƒ Soluciones</h2>
            <p>- Uso de energÃ­as renovables (solar, eÃ³lica, hidrÃ¡ulica).</p>
            <p>- Reducir, reciclar y reutilizar.</p>
            <p>- ReforestaciÃ³n y protecciÃ³n de ecosistemas.</p>
            <p>- Movilidad sostenible: caminar, usar bicicleta o transporte pÃºblico.</p>
        </div>

        <div class="section">
            <h2>ğŸ’¡ ReflexiÃ³n</h2>
            <p>
                El planeta no necesita que unas pocas personas lo cuiden perfectamente, 
                sino que millones lo hagan imperfectamente pero con constancia. 
                Â¡Cada acciÃ³n cuenta para combatir el calentamiento global!
            </p>
        </div>

        <div class="section rewards">
            <h2>ğŸ¯ Sistema de Puntos</h2>

            <!-- Puntos visibles -->
            <div class="points-display">
                <p><strong>Puntos actuales:</strong></p>
                <h1 id="puntos">0</h1>
            </div>

            <!-- Actividades -->
            <div class="activities">
                <h3>Actividades para ganar puntos</h3>
                <button onclick="sumarPuntos(5)">ğŸš¶ Caminar al colegio (+5)</button>
                <button onclick="sumarPuntos(10)">â™»ï¸ Reciclar plÃ¡sticos (+10)</button>
                <button onclick="sumarPuntos(15)">ğŸ’¡ Ahorrar energÃ­a (+15)</button>
                <button onclick="sumarPuntos(20)">ğŸŒ³ Plantar un Ã¡rbol (+20)</button>
            </div>

            <!-- Recompensas -->
            <div class="rewards-list">
                <h3>ğŸ† Recompensas desbloqueadas</h3>
                <ul id="recompensas"></ul>
            </div>
        </div>

        <!-- ================== NUEVA SECCIÃ“N: SISTEMA DE PUNTOS ================== -->
<div class="section">
  <h2>ğŸ† Sistema de Puntos EcolÃ³gicos</h2>
  <p>
    Cada acciÃ³n ecolÃ³gica suma puntos. Â¡Acumula y sube de nivel como defensor del planeta! ğŸŒ
  </p>

  <!-- VISTA PREVIA -->
  <div class="puntos-preview" id="preview">
    <h3>ğŸ‘¤ Vista previa</h3>
    <p id="previewUsuario">Usuario: -</p>
    <p id="previewPuntos">Puntos: 0</p>
    <p id="previewRanking">Ranking: -</p>
    <button onclick="mostrarSeccion()">ğŸ” Ver mÃ¡s</button>
  </div>

  <!-- SECCIÃ“N COMPLETA (inicialmente oculta) -->
  <div class="game-box" id="sistemaPuntos" style="display:none;">
    <h3 id="tituloUsuario"></h3>

    <label for="actividad">ğŸŒ± Selecciona una actividad:</label>
    <select id="actividad">
      <option value="10">Usar bicicleta (10 pts)</option>
      <option value="15">Plantar un Ã¡rbol (15 pts)</option>
      <option value="5">Reciclar (5 pts)</option>
      <option value="8">Ahorrar energÃ­a (8 pts)</option>
    </select>

    <button onclick="sumarPuntos()">âœ” Registrar actividad</button>

    <div class="score" id="resultado">
      ğŸ‘€ Esperando actividad...
    </div>

    <div class="ranking" id="ranking">
      <h3>ğŸ“‹ Ranking</h3>
      <ul id="listaRanking"></ul>
    </div>

    <button onclick="ocultarSeccion()">â¬… Volver a vista previa</button>
  </div>
</div>

<script>
  let usuarios = JSON.parse(localStorage.getItem("usuarios")) || {}; 
  let usuarioActivo = localStorage.getItem("usuarioActivo") || "Usuario";

  // Mostrar usuario en la vista previa apenas cargue
  window.onload = function() {
    document.getElementById("previewUsuario").textContent = `Usuario: ${usuarioActivo}`;
    document.getElementById("tituloUsuario").textContent = `ğŸ‘¤ Bienvenido, ${usuarioActivo}`;
    if (!usuarios[usuarioActivo]) usuarios[usuarioActivo] = 0;
    actualizarPreview();
  };

  function sumarPuntos() {
    const actividad = document.getElementById("actividad");
    const valor = parseInt(actividad.value);
    const texto = actividad.options[actividad.selectedIndex].text;

    usuarios[usuarioActivo] += valor;

    // Determinar nivel
    let nivel = "ğŸŒ± Semilla";
    if (usuarios[usuarioActivo] >= 20) nivel = "ğŸŒ¿ Brote";
    if (usuarios[usuarioActivo] >= 50) nivel = "ğŸŒ³ Ãrbol";
    if (usuarios[usuarioActivo] >= 100) nivel = "ğŸ”¥ HÃ©roe ClimÃ¡tico";

    // Mostrar resultado individual
    document.getElementById("resultado").innerHTML =
      `ğŸ‘ Â¡Bien hecho, ${usuarioActivo}!<br>` +
      `Has ganado <b>${valor}</b> puntos por: <i>${texto}</i>.<br>` +
      `ğŸŒ Total: <b>${usuarios[usuarioActivo]}</b> puntos.<br>` +
      `Nivel actual: <b>${nivel}</b>`;

    actualizarRanking();
    actualizarPreview();

    // Guardar en localStorage
    localStorage.setItem("usuarios", JSON.stringify(usuarios));
  }

  function actualizarRanking() {
    const lista = document.getElementById("listaRanking");
    lista.innerHTML = "";

    const ranking = Object.entries(usuarios).sort((a, b) => b[1] - a[1]);

    ranking.forEach(([usuario, puntos], index) => {
      const li = document.createElement("li");
      li.textContent = `${index + 1}. ${usuario} - ${puntos} pts`;
      lista.appendChild(li);
    });
  }

  function actualizarPreview() {
    const ranking = Object.entries(usuarios).sort((a, b) => b[1] - a[1]);
    const posicion = ranking.findIndex(([u]) => u === usuarioActivo) + 1;

    document.getElementById("previewUsuario").textContent = `Usuario: ${usuarioActivo}`;
    document.getElementById("previewPuntos").textContent = `Puntos: ${usuarios[usuarioActivo]}`;
    document.getElementById("previewRanking").textContent = `Ranking: #${posicion}`;
  }

  function mostrarSeccion() {
    document.getElementById("preview").style.display = "none";
    document.getElementById("sistemaPuntos").style.display = "block";
  }

  function ocultarSeccion() {
    document.getElementById("sistemaPuntos").style.display = "none";
    document.getElementById("preview").style.display = "block";
  }
</script>

       <!-- ================== SECCIÃ“N AVATAR ================== -->
<div class="section">
  <h2>ğŸ§‘ Tu Avatar EcolÃ³gico</h2>

  <!-- Contenedor del avatar 2D -->
  <div style="position: relative; width: 150px; height: 250px; margin: 20px auto;">
    <canvas id="avatar-canvas" width="150" height="250" style="position:absolute;"></canvas>
  </div>

  <!-- Avatar 3D de Ready Player Me -->
  <div id="avatar-container" style="text-align: center; margin-top: 30px;">
    <h3>ğŸŒ Avatar 3D</h3>
    <div class="avatar-container">
    <model-viewer id="avatar-frame"
                  src="models/avatar1.2.glb"
                  alt="Avatar 3D"
                  camera-controls
                  auto-rotate
                  style="width: 300px; height: 500px; background-color: #fff; border-radius: 10px;">
    </model-viewer>
</div>

    <p id="avatarMensaje">Â¡Bienvenido, <span id="nombreUsuario"></span>!</p>
  </div>

  
  <!-- Tienda de ropa y accesorios -->
  <h3>ğŸ› Tienda de accesorios</h3>
  <div id="tienda" style="display: flex; flex-direction: column; gap: 10px; max-width: 250px; margin: auto;">
    <button onclick="comprar('camiseta-verde', 20, 'ropa')">ğŸ‘• Camiseta verde (20 pts)</button>
    <button onclick="comprar('camiseta-azul', 25, 'ropa')">ğŸ‘• Camiseta azul (25 pts)</button>
    <button onclick="comprar('gorra', 15, 'accesorio')">ğŸ§¢ Gorra (15 pts)</button>
    <button onclick="comprar('camiseta-i-love-trees', 30, 'ropa')">ğŸ‘• Camiseta "I Love Trees" (30 pts)</button>
  </div>

  <div id="estadoCompra" class="score" style="margin-top:15px;">
    Saldo actual: <b id="puntosUsuario"></b> pts
  </div>
</div>

<!-- ================== SCRIPTS ================== -->
<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
<script>


// Inicializa usuario
if (!usuarios[usuarioActivo]) usuarios[usuarioActivo] = 0;

// Inicializa avatar en localStorage (2D)
if (!localStorage.getItem(`avatar_${usuarioActivo}`)) {
  localStorage.setItem(`avatar_${usuarioActivo}`, JSON.stringify({ ropa: "", accesorio: "", texto: "" }));
}

document.getElementById("nombreUsuario").textContent = usuarioActivo;
document.getElementById("puntosUsuario").textContent = usuarios[usuarioActivo];

// ==== Avatar 2D ====
const canvas = document.getElementById('avatar-canvas');
const ctx = canvas.getContext('2d');

function actualizarAvatar2D() {
  const data = JSON.parse(localStorage.getItem(`avatar_${usuarioActivo}`));
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Ropa
  if (data.ropa) {
    const ropa = new Image();
    ropa.src = `img/${data.ropa}.png`;
    ropa.onload = () => ctx.drawImage(ropa, 0, 0, canvas.width, canvas.height);
  }

  // Accesorio
  if (data.accesorio) {
    const acc = new Image();
    acc.src = `img/${data.accesorio}.png`;
    acc.onload = () => ctx.drawImage(acc, 0, 0, canvas.width, canvas.height);
  }

  // Texto
  if (data.texto) {
    ctx.fillStyle = 'white';
    ctx.font = '16px Arial';
    ctx.textAlign = 'center';
    ctx.fillText(data.texto, canvas.width/2, canvas.height/2 + 20);
  }

  // Camiseta especial
  if (data.ropa === "camiseta-i-love-trees") {
    const icono = new Image();
    icono.src = "img/camiseta-i-love-trees.png";
    icono.onload = () => ctx.drawImage(icono, 40, 100, 70, 70);
  }

  document.getElementById("puntosUsuario").textContent = usuarios[usuarioActivo];
}

function personalizarCamiseta() {
  const texto = document.getElementById('textoCamiseta').value;
  const data = JSON.parse(localStorage.getItem(`avatar_${usuarioActivo}`));
  data.texto = texto;
  localStorage.setItem(`avatar_${usuarioActivo}`, JSON.stringify(data));
  actualizarAvatar2D();
}

function comprar(item, costo, tipo) {
  if (usuarios[usuarioActivo] >= costo) {
    usuarios[usuarioActivo] -= costo;
    const data = JSON.parse(localStorage.getItem(`avatar_${usuarioActivo}`));
    data[tipo] = item;
    localStorage.setItem(`avatar_${usuarioActivo}`, JSON.stringify(data));
    localStorage.setItem("usuarios", JSON.stringify(usuarios));
    document.getElementById("estadoCompra").innerHTML = 
      `âœ… Compraste ${item}!<br>Saldo actual: <b>${usuarios[usuarioActivo]}</b> pts`;
    actualizarAvatar2D();
  } else {
    document.getElementById("estadoCompra").innerHTML = "âŒ No tienes puntos suficientes.";
  }
}

// ==== Avatar 3D Ready Player Me ====
const avatarURL = localStorage.getItem(`avatar3D_${usuarioActivo}`) 
                  || "https://models.readyplayer.me/68d5d23f25c2d350d246f268.glb";

document.getElementById("avatar-frame").setAttribute("src", avatarURL);

// Inicializar avatar 2D al cargar
actualizarAvatar2D();
</script>
